<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DagBox: data::datastore Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DagBox
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacedata.html">data</a></li><li class="navelem"><a class="el" href="classdata_1_1datastore.html">datastore</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="classdata_1_1datastore-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">data::datastore Class Reference<span class="mlabels"><span class="mlabel">abstract</span></span></div>  </div>
</div><!--header-->
<div class="contents">

<p>The base class for all key-value storage workers.  
 <a href="classdata_1_1datastore.html#details">More...</a></p>
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Inheritance diagram for data::datastore:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classdata_1_1datastore__inherit__graph.png" border="0" usemap="#data_1_1datastore_inherit__map" alt="Inheritance graph"/></div>
<map name="data_1_1datastore_inherit__map" id="data_1_1datastore_inherit__map">
<area shape="rect" id="node2" href="classdata_1_1reader.html" title="A datatore reader. " alt="" coords="5,80,107,107"/>
<area shape="rect" id="node3" href="classdata_1_1writer.html" title="A datatore writer. " alt="" coords="131,80,229,107"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div id="dynsection-1" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-1-trigger" src="closed.png" alt="+"/> Collaboration diagram for data::datastore:</div>
<div id="dynsection-1-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-1-content" class="dyncontent" style="display:none;">
<div class="center"><img src="classdata_1_1datastore__coll__graph.png" border="0" usemap="#data_1_1datastore_coll__map" alt="Collaboration graph"/></div>
<map name="data_1_1datastore_coll__map" id="data_1_1datastore_coll__map">
<area shape="rect" id="node2" title="STL class. " alt="" coords="31,96,118,123"/>
<area shape="rect" id="node3" title="STL class. " alt="" coords="5,5,144,47"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a063041c48cee0978935938543623e7f0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdata_1_1datastore.html#a063041c48cee0978935938543623e7f0">datastore</a> (<a class="el" href="classdata_1_1storage.html">storage</a> &amp;env)</td></tr>
<tr class="memdesc:a063041c48cee0978935938543623e7f0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a datastore worker.  <a href="#a063041c48cee0978935938543623e7f0">More...</a><br /></td></tr>
<tr class="separator:a063041c48cee0978935938543623e7f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9f095f3b5c454cc0b2f379feac2d0be7"><td class="memItemLeft" align="right" valign="top">auto&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdata_1_1datastore.html#a9f095f3b5c454cc0b2f379feac2d0be7">operator()</a> (<a class="el" href="classmsg_1_1request.html">msg::request</a> &amp;&amp;request) -&gt; std::vector&lt; zmq::message_t &gt;</td></tr>
<tr class="memdesc:a9f095f3b5c454cc0b2f379feac2d0be7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process a data storage request.  <a href="#a9f095f3b5c454cc0b2f379feac2d0be7">More...</a><br /></td></tr>
<tr class="separator:a9f095f3b5c454cc0b2f379feac2d0be7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:ac6c3a729fb490a2375d1a1e8f2bf0742"><td class="memItemLeft" align="right" valign="top">std::string const&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdata_1_1datastore.html#ac6c3a729fb490a2375d1a1e8f2bf0742">service_name</a> = &quot;datastore&quot;</td></tr>
<tr class="memdesc:ac6c3a729fb490a2375d1a1e8f2bf0742"><td class="mdescLeft">&#160;</td><td class="mdescRight">The name of the service.  <a href="#ac6c3a729fb490a2375d1a1e8f2bf0742">More...</a><br /></td></tr>
<tr class="separator:ac6c3a729fb490a2375d1a1e8f2bf0742"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a19007cc40a9cb58288ec24d46566041d"><td class="memItemLeft" align="right" valign="top">auto&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdata_1_1datastore.html#a19007cc40a9cb58288ec24d46566041d">get_open_bucket</a> (std::string bucket_name, lmdb::txn &amp;txn) -&gt; lmdb::dbi &amp;</td></tr>
<tr class="memdesc:a19007cc40a9cb58288ec24d46566041d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a bucket.  <a href="#a19007cc40a9cb58288ec24d46566041d">More...</a><br /></td></tr>
<tr class="separator:a19007cc40a9cb58288ec24d46566041d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91d2f061e2af6847c2a6a68802212b7c"><td class="memItemLeft" align="right" valign="top">virtual auto&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdata_1_1datastore.html#a91d2f061e2af6847c2a6a68802212b7c">process_request</a> (msgpack::object_handle &amp;req, lmdb::txn &amp;txn) -&gt; msgpack::sbuffer=0</td></tr>
<tr class="memdesc:a91d2f061e2af6847c2a6a68802212b7c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process a request and return a response.  <a href="#a91d2f061e2af6847c2a6a68802212b7c">More...</a><br /></td></tr>
<tr class="separator:a91d2f061e2af6847c2a6a68802212b7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23e8e268d90d60af5ca29c24dc26ce5a"><td class="memItemLeft" align="right" valign="top">virtual auto&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdata_1_1datastore.html#a23e8e268d90d60af5ca29c24dc26ce5a">bucket_open_flags</a> () const -&gt; unsigned int=0</td></tr>
<tr class="memdesc:a23e8e268d90d60af5ca29c24dc26ce5a"><td class="mdescLeft">&#160;</td><td class="mdescRight">The flags that should be used when opening buckets.  <a href="#a23e8e268d90d60af5ca29c24dc26ce5a">More...</a><br /></td></tr>
<tr class="separator:a23e8e268d90d60af5ca29c24dc26ce5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9af8b9dc531aeaba362d98880a886b02"><td class="memItemLeft" align="right" valign="top">virtual auto&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classdata_1_1datastore.html#a9af8b9dc531aeaba362d98880a886b02">txn_begin_flags</a> () const -&gt; unsigned int=0</td></tr>
<tr class="memdesc:a9af8b9dc531aeaba362d98880a886b02"><td class="mdescLeft">&#160;</td><td class="mdescRight">The flags that should be used when starting transactions .  <a href="#a9af8b9dc531aeaba362d98880a886b02">More...</a><br /></td></tr>
<tr class="separator:a9af8b9dc531aeaba362d98880a886b02"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The base class for all key-value storage workers. </p>
<p>Provides various utilities for accessing key-value <a class="el" href="classdata_1_1storage.html">storage</a>. Requests and replies are expected to be serialized with messagepack. Child classes must override the protected functions provided here to implement their own functionality.</p>
<p>This class also implements the required interface for <a class="el" href="classassistant.html">assistant</a>, thus the classes that inherit it will be compatible with assistant. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a063041c48cee0978935938543623e7f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a063041c48cee0978935938543623e7f0">&#9670;&nbsp;</a></span>datastore()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">datastore::datastore </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classdata_1_1storage.html">storage</a> &amp;&#160;</td>
          <td class="paramname"><em>env</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a datastore worker. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">env</td><td>Storage that the datastore worker will use. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a23e8e268d90d60af5ca29c24dc26ce5a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23e8e268d90d60af5ca29c24dc26ce5a">&#9670;&nbsp;</a></span>bucket_open_flags()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual auto data::datastore::bucket_open_flags </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const -&gt;  unsigned int</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The flags that should be used when opening buckets. </p>
<p>The datastore will open LMDB databases using the flags returned by this function. See the flags in <a href="http://www.lmdb.tech/doc/group__mdb.html#gac08cad5b096925642ca359a6d6f0562a">LMDB's documentation</a> for possible values this function may return. </p>

</div>
</div>
<a id="a19007cc40a9cb58288ec24d46566041d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a19007cc40a9cb58288ec24d46566041d">&#9670;&nbsp;</a></span>get_open_bucket()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">auto datastore::get_open_bucket </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>bucket_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">lmdb::txn &amp;&#160;</td>
          <td class="paramname"><em>txn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> -&gt; lmdb::dbi &amp;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get a bucket. </p>
<p>If the bucket doesn't exist, it will be created. If it does exist but it hasn't been opened yet, it will be opened. In any case, the existing open bucket will be returned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bucket_name</td><td>The name of the requested bucket. Any string may be used, subject to limitations of LMDB. </td></tr>
    <tr><td class="paramname">txn</td><td>The current transaction. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a9f095f3b5c454cc0b2f379feac2d0be7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f095f3b5c454cc0b2f379feac2d0be7">&#9670;&nbsp;</a></span>operator()()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">auto datastore::operator() </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmsg_1_1request.html">msg::request</a> &amp;&amp;&#160;</td>
          <td class="paramname"><em>request</em></td><td>)</td>
          <td> -&gt; std::vector&lt;zmq::message_t&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Process a data storage request. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">request</td><td>A request message for data storage.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A reply message that contains the response to the requst, ready to be sent. </dd></dl>

</div>
</div>
<a id="a91d2f061e2af6847c2a6a68802212b7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a91d2f061e2af6847c2a6a68802212b7c">&#9670;&nbsp;</a></span>process_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual auto data::datastore::process_request </td>
          <td>(</td>
          <td class="paramtype">msgpack::object_handle &amp;&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">lmdb::txn &amp;&#160;</td>
          <td class="paramname"><em>txn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> -&gt;  msgpack::sbuffer</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Process a request and return a response. </p>
<p>Child classes must override this method to provide their own request processing behaviour. The datastore will handle details such as de-serializing of the request and opening an LMDB transaction.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">req</td><td>The request that needs to be processed. </td></tr>
    <tr><td class="paramname">txn</td><td>The current transaction that has been opened for this request. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a9af8b9dc531aeaba362d98880a886b02"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9af8b9dc531aeaba362d98880a886b02">&#9670;&nbsp;</a></span>txn_begin_flags()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual auto data::datastore::txn_begin_flags </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const -&gt;  unsigned int</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The flags that should be used when starting transactions . </p>
<p>The datastore will start LMDB transactions using the flags returned by this function. See the flags in <a href="http://www.lmdb.tech/doc/group__mdb.html#gad7ea55da06b77513609efebd44b26920">LMDB's documentation</a> for possible values this function may return. </p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="ac6c3a729fb490a2375d1a1e8f2bf0742"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6c3a729fb490a2375d1a1e8f2bf0742">&#9670;&nbsp;</a></span>service_name</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string const data::datastore::service_name = &quot;datastore&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The name of the service. </p>
<p>Inheriting classes may override this name with a name of their choice. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/worker/<a class="el" href="datastore_8hpp_source.html">datastore.hpp</a></li>
<li>src/worker/datastore.cpp</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon May 22 2017 00:20:02 for DagBox by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
